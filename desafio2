#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>

#define MAX 20

typedef struct { char nome[30], tipo[20]; int p; } Comp;

Comp v[MAX];
int n = 0, comp;

void add(){
    if(n==MAX){printf("Limite!\n");return;}
    printf("Nome: "); fgets(v[n].nome,30,stdin); v[n].nome[strcspn(v[n].nome,"\n")]=0;
    printf("Tipo: "); fgets(v[n].tipo,20,stdin); v[n].tipo[strcspn(v[n].tipo,"\n")]=0;
    printf("Prioridade (1-10): "); scanf("%d",&v[n].p); getchar();
    n++; printf("OK!\n");
}

void show(){
    for(int i=0;i<n;i++) printf("%s | %s | %d\n",v[i].nome,v[i].tipo,v[i].p);
}

void bubbleNome(){
    comp = 0;
    for(int i=0;i<n-1;i++)
        for(int j=0;j<n-i-1;j++){
            comp++;
            if(strcmp(v[j].nome,v[j+1].nome)>0){
                Comp t=v[j]; v[j]=v[j+1]; v[j+1]=t;
            }
        }
}

void insertionTipo(){
    comp=0;
    for(int i=1;i<n;i++){
        Comp key=v[i]; int j=i-1;
        while(j>=0 && (++comp && strcmp(key.tipo,v[j].tipo)<0)){
            v[j+1]=v[j]; j--;
        }
        v[j+1]=key;
    }
}

void selectionPrior(){
    comp=0;
    for(int i=0;i<n-1;i++){
        int m=i;
        for(int j=i+1;j<n;j++){
            comp++;
            if(v[j].p < v[m].p) m=j;
        }
        Comp t=v[i]; v[i]=v[m]; v[m]=t;
    }
}

void buscaBin(){
    if(!n){printf("Vazio\n");return;}
    char x[30]; printf("Buscar nome: "); fgets(x,30,stdin); x[strcspn(x,"\n")]=0;
    int l=0,r=n-1; comp=0;
    while(l<=r){
        int m=(l+r)/2; comp++;
        int c=strcmp(x,v[m].nome);
        if(!c){ printf("Achado: %s | %s | %d\nComp: %d\n",v[m].nome,v[m].tipo,v[m].p,comp); return; }
        else if(c>0) l=m+1; else r=m-1;
    }
    printf("Nao achou | Comp: %d\n",comp);
}

void medir(void (*f)()){
    clock_t ini=clock(); f(); clock_t fim=clock();
    double t=(double)(fim-ini)/CLOCKS_PER_SEC;
    printf("OK | Comp: %d | Tempo: %.6fs\n",comp,t);
}

int main(){
    int o,s; 
    do{
        printf("\n1 Add\n2 Ver\n3 Ordenar\n4 Buscar binaria\n0 Sair\n> ");
        scanf("%d",&o); getchar();
        if(o==1)add();
        else if(o==2)show();
        else if(o==3){
            printf("1 Nome(Bubble)\n2 Tipo(Insertion)\n3 Prioridade(Selection)\n> ");
            scanf("%d",&s); getchar();
            if(s==1)medir(bubbleNome);
            else if(s==2)medir(insertionTipo);
            else if(s==3)medir(selectionPrior);
            show();
        }
        else if(o==4)buscaBin();
    }while(o!=0);
}

